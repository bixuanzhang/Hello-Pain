<html>
<head>
<title>空间数据编码</title>
</head>

<body>
<script language="javascript>
//检查浏览器是否支持File API
function isSupportFileApi() {
    if(window.File && window.FileList && window.FileReader && window.Blob) {
        return true;
    }
    return false;
}

//单表输入
function fileSelect1(e) {
    var files = this.files;
    for(var i = 0, len = files.length; i < len; i++) {
        var f = files[i];
        html.push(
            '<p>',
                f.name + '(' + (f.type || "n/a") + ')' + ' - ' + f.size + 'bytes',
            '</p>'
        );
    }
    document.getElementById('list1').innerHTML = html.join('');
}
document.getElementById('file1').onchange = fileSelect1;

//拖拽文件
function dropHandler(e) {
    e.stopPropagation();
    e.preventDefault();

    var files = e.dataTransfer.files;
    for(var i = 0, len = files.length; i < len; i++) {
        var f = files[i];
        html.push(
            '<p>',
                f.name + '(' + (f.type || "n/a") + ')' + ' - ' + f.size + 'bytes',
            '</p>'
        );
    }
    document.getElementById('list2').innerHTML = html.join('');
}
function dragOverHandler(e) {
    e.stopPropagation();
    e.preventDefault();
    e.dataTransfer.dragEffect = 'copy';
}
var drag = document.getElementById('drag');
drag.addEventListener('drop', dropHandler, false);
drag.addEventListener('dragover', dragOverHandler, false);

//文件读取
function fileSelect3(e) {
    e = e || window.event;

    var files = this.files;
    var p = document.getElementById('preview3');

    for(var i = 0, f; f = files[i]; i++) {
        var reader = new FileReader();
        reader.onload = (function(file) {
            return function(e) {
                var div = document.createElement('div');
                div.className = "text"
                div.innerHTML = encodeHTML(this.result);

                p.insertBefore(div, null);
            };
        })(f);
        //读取文件内容
    
    var arr1=new Array();
    var arr2=new Array();
    var arr3=new Array();
    var arr=new Aray();
    arr=files.split("");
    for(var j=0,n=0;j<arr.length;j++,n++){
      arr1[j]=arr[j];
      arr2[j]=arr[j+3n+1];
      arr3[j]=arr[j+3n+2];
       }
    for(var i=0;i<arr.length;i++){
      var x=arr2[i];
      var y=16-arr3[i];
      if(i==0){
        ctx.moveTo(x,y);
          }
      else ctx.lineTo(x,y);
      ctx.stroke();
       }
    }
}
document.getElementById('files3').addEventListener('change', fileSelect3, false);

</script>
</body>
</html>